[tools]
uv = "latest"
ruff = "latest"

[tasks.install]
run = "uv pip install -e .[dev]"
help = "Install the project in dev mode."

[tasks.fmt]
run = "ruff format ."
help = "Format code using ruff."

[tasks.lint]
run = "ruff check ."
help = "Run ruff linter."

[tasks."test:pytest"]
run = "uv run pytest -v --cov-config .coveragerc --cov=bumpkin -l --tb=short --maxfail=1 tests/"
help = "Run pytest."
depends = ["install", "lint"]

[tasks."test:coverage-xml"]
run = "uv run coverage xml"
help = "Generate coverage xml report."
depends = ["test:pytest"]

[tasks."test:coverage-html"]
run = "uv run coverage html"
help = "Generate coverage html report."
depends = ["test:pytest"]

[tasks.test]
help = "Run all tests."
depends = ["test:*"]

[tasks.check]
depends = ["lint", "test"]

[tasks.release]
run = """
echo "WARNING: This operation will create s version tag and push to github"
read -p "Version? (provide the next x.y.z semver) : " TAG
echo "$TAG" > bumpkin/VERSION
uv run gitchangelog > HISTORY.md
git add bumpkin/VERSION HISTORY.md
git commit -m "release: version $TAG ðŸš€"
echo "creating git tag : $TAG"
git tag "$TAG"
git push -u origin HEAD --tags
echo "Github Actions will detect the new tag and release the new version."
"""
help = "Create a new tag for release."
